// Generated by CoffeeScript 1.3.3
(function() {
  var MockWebSocket, Scrud, assert, expect, mockWebSocket, scrudConnection, sinon;

  expect = require("./expect.js");

  sinon = require("sinon");

  Scrud = require("./Scrud.js");

  MockWebSocket = require("./MockWebSocket.js");

  assert = new expect.Assertion;

  scrudConnection = new Scrud("ws://localhost:8080/websocket");

  scrudConnection.connect();

  mockWebSocket = MockWebSocket.lastCreated;

  suite('Create', function() {});

  test('correct JSON is produced', function() {
    var createMessage, jsonSent, resource, type;
    scrudConnection.currentClientId = 0;
    type = "Item";
    resource = {
      name: 'MyItem'
    };
    createMessage = new scrudConnection.Create(type, resource, function() {
      var success;
      return success = true;
    });
    createMessage.send();
    jsonSent = mockWebSocket.lastMessageSent;
    return expect(jsonSent).to.equal('{"client-id":"cId-1","type":"Item","resource":{"name":"MyItem"}}');
  });

  test('onSuccess function should be called', function() {
    var clientId, createMessage, resource, success, type;
    type = "Item";
    resource = {
      name: 'MyItem'
    };
    success = false;
    createMessage = new scrudConnection.Create(type, resource, function() {
      return success = true;
    });
    clientId = createMessage.clientId;
    createMessage.send();
    mockWebSocket.receive("{\"client-id\": \"" + clientId + "\", \"message-type\": \"create-success\"}");
    return expect(success).to.equal(true);
  });

}).call(this);
